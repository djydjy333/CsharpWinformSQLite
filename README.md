# 任务管理器 - SQLite 轻量版

一个基于 C# WinForms 的桌面任务管理应用，支持用户登录和 SQLite 本地数据库存储。

## 与 MySQL 版本对比

| 对比项 | SQLite 版 | MySQL 版 |
|--------|-----------|----------|
| 依赖 DLL 数量 | 1 个 | 11 个 |
| 需要安装服务 | 否 | 是 |
| 数据存储位置 | 本地文件 | MySQL 服务器 |
| 部署复杂度 | 简单 | 较复杂 |
| 适用场景 | 单机应用 | 多用户/网络应用 |

## 功能特性

- **用户系统**
  - 用户注册（用户名至少3字符，密码至少4字符）
  - 用户登录（SHA256 加密存储密码）
  - 记住用户名功能
  - 退出登录/切换用户
  - 每个用户数据独立

- **任务管理**
  - 添加、修改、删除任务
  - 优先级设置 - 高（红）、中（黄）、低（绿）
  - 完成状态 - 标记完成/取消，删除线效果
  - 清空当前用户的所有任务

- **数据持久化**
  - 自动保存到本地 SQLite 数据库
  - 统计信息实时显示

## 环境要求

- Windows 7 或更高版本
- .NET Framework 4.0 或更高版本
- **无需安装数据库服务**

## 项目结构

```
E:\CsharpWinformSQLite\
├── TaskManager.sln          # Visual Studio 解决方案文件
├── TaskManager.csproj       # 项目文件
├── packages.config          # NuGet 包配置
├── Program.cs               # 程序入口
├── LoginForm.cs             # 登录窗体逻辑代码
├── LoginForm.Designer.cs    # 登录窗体设计器代码
├── MainForm.cs              # 主窗体逻辑代码
├── MainForm.Designer.cs     # 主窗体设计器代码
├── TaskManager.exe          # 可执行文件
├── build.bat                # 命令行编译脚本
├── README.md                # 说明文档
├── System.Data.SQLite.dll   # SQLite 托管库
├── x86\                     # 32位原生库
│   └── SQLite.Interop.dll
├── x64\                     # 64位原生库
│   └── SQLite.Interop.dll
├── tasks.db                 # 数据库文件（运行后自动创建）
└── packages\                # NuGet 包目录
```

## 快速开始

### 运行程序

1. 双击 `TaskManager.exe`
2. 首次使用需要注册账号
3. 输入用户名和密码，点击"注册"
4. 注册成功后点击"登录"

### 使用 Visual Studio 开发

1. 双击 `TaskManager.sln` 打开解决方案
2. 在解决方案资源管理器中双击 `LoginForm.cs` 或 `MainForm.cs`
3. 即可使用窗体设计器进行可视化编辑
4. 按 F5 编译并运行

### 命令行编译

双击运行 `build.bat` 即可编译，或使用 PowerShell：

```powershell
Set-Location 'E:\CsharpWinformSQLite'
.\build.bat
```

## 使用说明

### 登录/注册

```
┌───────────────────────────────────┐
│       任务管理器                    │
├───────────────────────────────────┤
│  用户名： ┌─────────────────┐      │
│          │                 │      │
│          └─────────────────┘      │
│  密  码： ┌─────────────────┐      │
│          │ ●●●●●●          │      │
│          └─────────────────┘      │
│          ☑ 记住用户名              │
│                                   │
│      ┌────────┐  ┌────────┐      │
│      │ 登 录  │  │ 注 册  │      │
│      └────────┘  └────────┘      │
└───────────────────────────────────┘
```

- **注册**：输入用户名（≥3字符）和密码（≥4字符），点击"注册"
- **登录**：输入已注册的用户名和密码，点击"登录"
- **记住用户名**：勾选后下次自动填充用户名

### 任务操作

| 操作 | 方法 |
|------|------|
| 添加任务 | 输入内容 → 选择优先级 → 点击"添加"或按 Enter |
| 修改任务 | 双击任务 或 选中后点击"修改选中" |
| 删除任务 | 选中任务 → 点击"删除选中" |
| 标记完成 | 选中任务 → 点击"标记完成" |
| 退出登录 | 点击右上角"退出登录"按钮 |

### 快捷键

| 快捷键 | 功能 |
|--------|------|
| Enter | 登录 / 添加任务 / 保存修改 |
| Esc | 取消编辑模式 |
| 双击 | 进入编辑模式 |

## 数据库结构

数据库文件：`tasks.db`（与 exe 同目录）

### users 表（用户）

| 字段 | 类型 | 说明 |
|------|------|------|
| id | INTEGER | 主键，自增 |
| username | TEXT | 用户名（唯一） |
| password_hash | TEXT | 密码哈希（SHA256） |
| created_at | TEXT | 注册时间 |

### tasks 表（任务）

| 字段 | 类型 | 说明 |
|------|------|------|
| id | INTEGER | 主键，自增 |
| user_id | INTEGER | 用户ID（外键） |
| content | TEXT | 任务内容 |
| priority | TEXT | 优先级（高/中/低） |
| is_completed | INTEGER | 是否完成（0/1） |
| created_at | TEXT | 创建时间 |
| completed_at | TEXT | 完成时间 |
| updated_at | TEXT | 更新时间 |

### settings 表（设置）

| 字段 | 类型 | 说明 |
|------|------|------|
| key | TEXT | 设置键（主键） |
| value | TEXT | 设置值 |

## 安全说明

- 密码使用 SHA256 + Salt 加密存储
- 不存储明文密码
- 每个用户只能看到自己的任务

## 界面预览

### 登录界面
```
┌────────────────────────────────┐
│        任务管理器               │
│                                │
│  用户名：[_______________]     │
│  密  码：[●●●●●●_________]     │
│          ☑ 记住用户名          │
│                                │
│     [ 登 录 ]  [ 注 册 ]       │
│                                │
│      注册成功！请点击登录       │
└────────────────────────────────┘
```

### 主界面
```
┌─────────────────────────────────────────────────────────────┐
│  任务管理器 - admin                   当前用户: admin [退出登录] │
├─────────────────────────────────────────────────────────────┤
│  任务内容：                    优先级：                          │
│  ┌────────────────────────┐   ┌────┐  ┌────────┐              │
│  │                        │   │ 中 ▼│  │添加任务│              │
│  └────────────────────────┘   └────┘  └────────┘              │
├─────────────────────────────────────────────────────────────┤
│  序号 │ 状态 │ 任务内容           │ 优先级 │ 创建时间 │ 完成时间 │
│ ──────┼──────┼────────────────────┼────────┼──────────┼──────── │
│   1   │  ○   │ 完成项目文档       │   高   │ 02-09... │          │
│   2   │  ✓   │ 修复登录Bug        │   中   │ 02-09... │ 02-09... │
├─────────────────────────────────────────────────────────────┤
│  ┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐                  │
│  │标记完成│ │修改选中│ │删除选中│ │清空全部│                  │
│  └────────┘ └────────┘ └────────┘ └────────┘                  │
│                                                               │
│  总计: 2 | 进行中: 1 | 已完成: 1                              │
└─────────────────────────────────────────────────────────────┘
```

## 常见问题

### Q: 忘记密码怎么办？

**A:** 目前没有找回密码功能。可以使用 SQLite 工具删除 users 表中的记录，或删除 tasks.db 重新注册。

### Q: 如何备份数据？

**A:** 直接复制 `tasks.db` 文件即可，包含所有用户和任务数据。

### Q: 多人可以同时使用吗？

**A:** 可以注册多个账号，每个用户的任务数据是独立的，但数据都存在同一个本地文件中。

### Q: 程序无法启动？

**A:** 确保以下文件结构完整：
```
TaskManager.exe
System.Data.SQLite.dll
x86\SQLite.Interop.dll
x64\SQLite.Interop.dll
```

### Q: 从旧版本升级后添加任务报错？

**A:** v1.1.1 已自动处理此问题。程序会检测旧版数据库表结构并自动升级。如仍有问题，可删除 `tasks.db` 文件重新开始。

### Q: 如何在 Visual Studio 中编辑窗体界面？

**A:**
1. 双击 `TaskManager.sln` 打开项目
2. 在解决方案资源管理器中双击 `LoginForm.cs` 或 `MainForm.cs`
3. 切换到"设计"视图即可拖拽控件进行可视化编辑
4. 设计器会自动更新对应的 `.Designer.cs` 文件

## 代码结构

```
TaskManager/
├── Program.cs                 # 程序入口，管理登录/主窗体循环
│
├── LoginForm.cs               # 登录窗体逻辑
│   ├── InitializeDatabase()   - 创建用户表和设置表
│   ├── HashPassword()         - SHA256 密码加密
│   ├── btnLogin_Click()       - 登录验证
│   ├── btnRegister_Click()    - 用户注册
│   ├── LoadRememberedUser()   - 加载记住的用户名
│   └── SaveRememberedUser()   - 保存用户名
│
├── LoginForm.Designer.cs      # 登录窗体 UI 布局（VS设计器生成）
│
├── MainForm.cs                # 主窗体逻辑
│   ├── GetUserId()            - 获取当前用户ID
│   ├── InitializeTasksTable() - 创建/升级任务表
│   ├── LoadTasksFromDatabase()- 加载用户任务
│   ├── AddTask()              - 添加任务
│   ├── UpdateTask()           - 更新任务
│   ├── MarkAsComplete()       - 标记完成
│   └── btnLogout_Click()      - 退出登录
│
└── MainForm.Designer.cs       # 主窗体 UI 布局（VS设计器生成）
```

## 版本历史

### v1.2.0
- 重构为标准 Visual Studio 项目结构
- 添加 TaskManager.sln 解决方案文件
- 分离 Designer.cs 文件，支持窗体设计器可视化编辑
- 程序入口独立为 Program.cs
- 可执行文件更名为 TaskManager.exe

### v1.1.1
- 修复从旧版本升级时数据库表结构不兼容的问题
- 自动检测并升级旧版 tasks 表

### v1.1.0
- 新增用户登录/注册功能
- 每个用户数据独立
- 记住用户名功能
- 退出登录功能

### v1.0.0
- 基础任务管理功能
- SQLite 本地数据持久化
- 优先级和完成状态管理

## 许可证

本项目仅供学习参考使用。
